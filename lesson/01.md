# 1. Начало. Простая сборка всех файлов в текущей папке.

В тексте учебника я не буду приводить куски кода, только имена файлов с кодом. Ну а поскольку по мере занятий файлы кода будут меняться, то для просмотра кода из определенного занятия следует использовать теги git'а. Теги будут состоять из двух цифр - номер занятия и номер итерации кода в пределах занятия.

При этом текст учебника скорее всего будет удобнее смотреть на сайте, не забывая при этом переключаться на ветку master. Дело в том, что при переключении на тег, большая часть учебника будет теряться, поскольку учебник пишется параллельно созданию тегов. А все ссылки из текста на файлы привязаны к текущему тегу. При этом в тексте учебника, привязанного к тегу, информация может быть не только неполной, но и устаревшей, поскольку при написании новых разделов я допускаю исправление предыдущих разделов. Так что текст читаем только в ветке master.

При просмотре через сайт github для возврата от кода к тексту можно использовать файл current-lesson.md в корне проекта. Там ссылка содержит переход к ветке master.

Итак, начинаем тег lesson01.1. Обратите внимание, что точка после второй цифры тега не является частью тега, это точка конца предложения.

В первую очередь, при начале любого проекта, предполагающего компиляцию, создаём файл [.gitignore](https://github.com/ulresh/umake/blob/lesson01.1/.gitignore), в котором укажем папки для файлов с результатами компиляции.

Далее создаём файл [src/main.cpp](https://github.com/ulresh/umake/blob/lesson01.1/src/main.cpp) с точкой входа для нашей программы umake. В рамках первого занятия этот файл будет содержать весь исходный код нашей программы.

Создадим папку bin (`mkdir bin`).

Получить исполняемый файл можно командой
```
g++ -o bin/umake src/main.cpp -lboost_filesystem
```

Сам я использую библиотеку boost разных версий для разных проектов. Поэтому у меня команда немного отличается.
```
g++ -o bin/umake src/main.cpp -I/usr/local/share/boost_1_84/include \
  /usr/local/share/boost_1_84/lib/libboost_filesystem.a
```

На этом с тегом lesson01.1 закончили, начинаем обсуждать тег
### lesson01.2.

Определим папку, куда потребуется положить результат компиляции. Для этого найдем в папках, выше текущей, папку `.git`.

Используем boost::filesystem::path. Для начала определим текущую папку и разложим путь к текущей папке на части в порядке от текущей папки к корню.

Код в [src/main.cpp lesson01.2](/../lesson01.2/src/main.cpp), [посмотреть отличия](/../../compare/c011..c012).

К сожалению, я не смог найти прямого способа посмотреть через github отличия только для одного файла. Так что пришлось немножко поизгаляться с выделением в git commit'ов, содержащих только изменения интересующего меня файла.

### lesson01.3.

Добавляем функцию has_git_folder. Запоминаем путь от папки с `.git` до текущей папки. Также в in_src сохраняем признак того, что umake запущен в папке src корня проекта.

Код в [src/main.cpp lesson01.3](/../lesson01.3/src/main.cpp), [посмотреть отличия](/../../compare/c012..c013).

### lesson01.4.

Вынесем полученный код по определению корневой папки в класс RootFolder.

Код в [src/main.cpp lesson01.4](/../lesson01.4/src/main.cpp), [посмотреть отличия](/../../compare/c013..c014).

### lesson01.5.

Добавим в функции main обход текущей папки через boost::filesystem::recursive_directory_iterator.

В boost используется 2 вида обработки ошибок: исключения и вызов со ссылкой на объект boost::system::error_code с последующим анализом этого объекта. В контексте нашего проекта любая ошибка дисковой операции должна приводить к полному заврешению работы. Так что в данном конкретном случае проще будет обойтись без лишних телодвижений, оставив обработку ошибок на исключения, и даже не добавляя собственного обработчика исключений, а оставив системный.

Код в [src/main.cpp lesson01.5](/../lesson01.5/src/main.cpp), [посмотреть отличия](/../../compare/c014..c015).

### lesson01.6.

Добавим формирование имени (пути) для файла с результатом компиляции (объектного файла). Заниматься этим будет функция RootFolder::object_file. Также переделаем RootFolder::in_src, вместо него у нас теперь будет RootFolder::base. Удалим RootFolder::delta, он нам скорее всего не нужен.

Код в [src/main.cpp lesson01.6](/../lesson01.6/src/main.cpp), [посмотреть отличия](/../../compare/c015..c016).

### lesson01.7.

Добавим компиляцию файла через boost::process::system.

Код в [src/main.cpp lesson01.7](/../lesson01.7/src/main.cpp), [посмотреть отличия](/../../compare/c016..c017).

### lesson01f

На этом первое занятие закончено. Далее нам потребуется работа с файлом настроек, поскольку лично у меня, как я уже упоминал выше, boost лежит не в стандартной папке, так что требуется при вызове компилятора указать путь к нему.

Продолжение в [02.md](02.md).
